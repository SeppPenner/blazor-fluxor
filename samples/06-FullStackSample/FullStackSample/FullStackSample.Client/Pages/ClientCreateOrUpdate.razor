@page "/clients/{ClientId:int}/edit"
@page "/clients/create"
@inherits Blazor.Fluxor.Components.FluxorComponent
@inject IDispatcher Dispatcher
@inject IState<FullStackSample.Client.Store.ClientCreate.ClientCreateState> State

<nav aria-label="Breadcrumb">
	<ol class="breadcrumb">
		<li class="breadcrumb-item">
			<a href="/clients">Clients</a>
		</li>
		<li class="breadcrumb-item active">
			@ActionText
		</li>
	</ol>
</nav>
<EditForm Model="@Client" OnValidSubmit=@Submit>
	<PeterLeslieMorris.Blazor.Validation.Validate />
	<div class="form-group">
		<label for="Name">Name</label>
		<InputText @bind-Value=@Client.Name Class="form-control" aria-describedby="Name" @attributes=GetElementDisabled() />
		<ValidationMessage For=@(() => Client.Name) />
	</div>
	<div class="form-group">
		<label for="RegistrationNumber">Registration number</label>
		<InputNumber @bind-Value=@Client.RegistrationNumber Class="form-control" aria-describedby="Registration number" @attributes=GetElementDisabled() />
		<ValidationMessage For=@(() => Client.RegistrationNumber) />
	</div>
	<button type="submit" class="btn btn-primary" @attributes=@GetElementDisabled()>
		@(State.Value.IsExecutingApi ? ActionInProgressText : SubmitText)
	</button>
</EditForm>

@code {
	[Parameter] int? ClientId { get; set; }
	bool IsNew => !ClientId.HasValue;
	string ActionText => IsNew ? "Create" : "Edit";
	string SubmitText => IsNew ? "Create" : "Save";
	string ActionInProgressText => IsNew ? "Creating..." : "Saving...";

	Api.Models.ClientCreateOrUpdate Client = new Api.Models.ClientCreateOrUpdate();

	void Submit()
	{
		var command = new Api.Requests.ClientCreateCommand(Client);
		Dispatcher.Dispatch(command);
	}

	Dictionary<string, object> GetElementDisabled()
	{
		if (State.Value.IsExecutingApi)
			return new Dictionary<string, object> { ["disabled"] = "disabled" };
		return new Dictionary<string, object>();
	}
}